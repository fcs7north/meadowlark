<h2 class="text-primary">Vacation Photo Contest For Fetch</h2>
<div class="alert alert-primary" role="alert">
	{{year}}년 {{month}}월 {{date}}일
</div>

<div id="vacationPhotoContestFormContainer">
	<form
		id="vacationPhotoContestFrom"
		class="form-horizontal"
		role="form"
		enctype="multipart/form-data"
		method="POST"
		action="/contest/vacation-photo/{{year}}/{{month}}"
	>
		<input type="hidden" name="_csrf" value="{{csrf}}">
		<div class="form-group row mb-4">
			<label for="fieldName" class="col-sm-3 control-label">Name</label>
			<div class="col-sm-9">
				<input
					type="text"
					class="form-control"
					id="fieldName"
					name="name"
				>
			</div>
		</div>
		<div class="form-group row mb-4">
			<label for="fieldEmail" class="col-sm-3 control-label">Email</label>
			<div class="col-sm-9">
				<input
					type="email"
					class="form-control"
					required
					id="fieldEmail"
					name="email"
				>
			</div>
		</div>
		<div class="form-group row mb-4">
			<label for="fieldPhoto" class="col-sm-3 control-label">Vacation photo</label>
			<div class="col-sm-9">
				<input
					type="file"
					class="form-control"
					required
					accept="image/*"
					id="fieldPhoto"
					name="photo"
				>
			</div>
		</div>
		<div class="form-group row mb-4">
			<div class="col-sm-offset-2 col-sm-6">
				<button type="submit" class="btn btn-primary">Register</button>
			</div>
		</div>
	</form>
</div>

{{#section 'scripts'}}
	<script defer>
		document.getElementById('vacationPhotoContestFrom').addEventListener('submit', evt => {
			evt.preventDefault()
			const body = new FormData(evt.target)
			const container = document.getElementById('vacationPhotoContestFormContainer')
			fetch('/api/vacation-fetch-photo/{{year}}/{{month}}', { method: 'post', body })
				.then(resp => {
					if(resp.status < 200 || resp.status >= 300)
						throw new Error(`Request failed with status ${resp.status}`)
					return resp.json()
				})
				.then(json => {
					container.innerHTML =
						`<div class="alert alert-primary" role="alert">
							[Fetch!] 사진이 등록되었습니다!
							<hr>
							<a href="/" class="btn btn-success">홈으로</a>
							<a href="/vacation-fetch-photo" class="btn btn-primary">다른사진 올리기</a>
						</div>`
				})
				.catch(err => {
					container.innerHTML = 
						`<div class="alert alert-primary" role="alert">
							${err}
							[Fetch!] 죄송합니다! 오류가 발생하였습니다.<br>다시 시도해 주세요.
							<hr>
							<a href="/" class="btn btn-success">홈으로</a>
							<a href="/vacation-fetch-photo" class="btn btn-primary">다시 시도하기</a>
						</div>`
				})

				return false
		})
	</script>
{{/section}}